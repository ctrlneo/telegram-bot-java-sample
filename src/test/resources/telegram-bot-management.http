###
# Telegram Bot ç®¡ç†APIæµ‹è¯•ç”¨ä¾‹
# ç”¨äºè®¾ç½®Botèœå•ã€webhookç­‰ç®¡ç†åŠŸèƒ½
# é€‚ç”¨äº IntelliJ IDEA HTTP Client æˆ– VS Code REST Client
###

### ç¯å¢ƒå˜é‡å®šä¹‰
# åˆ›å»º http-client.env.json æˆ– .http-client.env.json æ–‡ä»¶æ¥å­˜å‚¨è¿™äº›å˜é‡
# {
#   "dev": {
#     "telegramBotToken": "your_bot_token_here",
#     "webhookUrl": "https://your-domain.com/bot/rest/tg/webhook",
#     "secretToken": "your_32_character_secret_token_here_minimum"
#   }
# }

### ============ Bot èœå•ç®¡ç† ============

### 1. è®¾ç½®Demo BotåŸºæœ¬èœå• (åŸºäºTelegramOperationTypeæšä¸¾)
POST https://api.telegram.org/bot{{telegramBotToken}}/setMyCommands
Content-Type: application/json

{
  "commands": [
    {
      "command": "start",
      "description": "å¼€å§‹ä½¿ç”¨æœºå™¨äºº"
    },
    {
      "command": "help",
      "description": "æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯"
    },
    {
      "command": "balance",
      "description": "æŸ¥è¯¢ä½™é¢"
    }
  ]
}

> {%
client.test("è®¾ç½®Demoèœå•æˆåŠŸ", function() {
    client.assert(response.status === 200, "çŠ¶æ€ç åº”ä¸º200");
    client.assert(response.body.ok === true, "è®¾ç½®åº”æˆåŠŸ");
    client.log("âœ… Demo Botèœå•è®¾ç½®æˆåŠŸ (start, help, balance)");
});
%}

### 2. è·å–å½“å‰Botèœå•
GET https://api.telegram.org/bot{{telegramBotToken}}/getMyCommands

> {%
client.test("è·å–èœå•æˆåŠŸ", function() {
    client.assert(response.status === 200, "çŠ¶æ€ç åº”ä¸º200");
    client.assert(response.body.ok === true, "è·å–åº”æˆåŠŸ");
    if (response.body.result.length > 0) {
        client.log("ğŸ“‹ å½“å‰èœå•æ•°é‡: " + response.body.result.length);
        response.body.result.forEach(function(cmd) {
            client.log("   /" + cmd.command + " - " + cmd.description);
        });
    }
});
%}

### 3. åˆ é™¤Botèœå•
POST https://api.telegram.org/bot{{telegramBotToken}}/deleteMyCommands
Content-Type: application/json

{}

> {%
client.test("åˆ é™¤èœå•æˆåŠŸ", function() {
    client.assert(response.status === 200, "çŠ¶æ€ç åº”ä¸º200");
    client.assert(response.body.ok === true, "åˆ é™¤åº”æˆåŠŸ");
    client.log("ğŸ—‘ï¸ èœå•å·²åˆ é™¤");
});
%}

### ============ Webhook ç®¡ç† ============

### 4. è®¾ç½®Demo Webhook
POST https://api.telegram.org/bot{{telegramBotToken}}/setWebhook
Content-Type: application/json

{
  "url": "{{webhookUrl}}",
  "secret_token": "{{secretToken}}",
  "max_connections": 40,
  "allowed_updates": ["message", "callback_query"],
  "drop_pending_updates": true
}

> {%
client.test("è®¾ç½®WebhookæˆåŠŸ", function() {
    client.assert(response.status === 200, "çŠ¶æ€ç åº”ä¸º200");
    client.assert(response.body.ok === true, "è®¾ç½®åº”æˆåŠŸ");
    client.assert(response.body.result.url === "{{webhookUrl}}", "Webhook URLåº”åŒ¹é…");
    client.log("ğŸ”— Webhookè®¾ç½®æˆåŠŸ: " + response.body.result.url);
    client.log("ğŸ”’ Secret Token: " + (response.body.result.has_custom_certificate ? "å·²è®¾ç½®" : "æœªè®¾ç½®"));
});
%}

### 5. è·å–Webhookä¿¡æ¯
GET https://api.telegram.org/bot{{telegramBotToken}}/getWebhookInfo

> {%
client.test("è·å–Webhookä¿¡æ¯æˆåŠŸ", function() {
    client.assert(response.status === 200, "çŠ¶æ€ç åº”ä¸º200");
    client.assert(response.body.ok === true, "è·å–åº”æˆåŠŸ");

    var webhook = response.body.result;
    client.log("ğŸ“Š Webhookä¿¡æ¯:");
    client.log("   URL: " + webhook.url);
    client.log("   è‡ªå®šä¹‰è¯ä¹¦: " + (webhook.has_custom_certificate ? "æ˜¯" : "å¦"));
    client.log("   å¾…å¤„ç†æ›´æ–°æ•°: " + webhook.pending_update_count);
    client.log("   æœ€åé”™è¯¯: " + (webhook.last_error_message || "æ— "));

    client.assert(webhook.url !== "", "Webhook URLä¸åº”ä¸ºç©º");
});
%}

### 6. åˆ é™¤Webhook
POST https://api.telegram.org/bot{{telegramBotToken}}/deleteWebhook
Content-Type: application/json

{
  "drop_pending_updates": true
}

> {%
client.test("åˆ é™¤WebhookæˆåŠŸ", function() {
    client.assert(response.status === 200, "çŠ¶æ€ç åº”ä¸º200");
    client.assert(response.body.ok === true, "åˆ é™¤åº”æˆåŠŸ");
    client.log("âŒ Webhookå·²åˆ é™¤");
});
%}

### ============ Bot ä¿¡æ¯ç®¡ç† ============

### 7. è·å–Botä¿¡æ¯
GET https://api.telegram.org/bot{{telegramBotToken}}/getMe

> {%
client.test("è·å–Botä¿¡æ¯æˆåŠŸ", function() {
    client.assert(response.status === 200, "çŠ¶æ€ç åº”ä¸º200");
    client.assert(response.body.ok === true, "è·å–åº”æˆåŠŸ");
    client.assert(response.body.result.is_bot === true, "åº”ä¸ºBotè´¦å·");

    var bot = response.body.result;
    client.global.set("botId", bot.id);
    client.global.set("botUsername", bot.username);
    client.log("ğŸ¤– Botä¿¡æ¯:");
    client.log("   ID: " + bot.id);
    client.log("   ç”¨æˆ·å: @" + bot.username);
    client.log("   åç§°: " + bot.first_name + (bot.last_name ? " " + bot.last_name : ""));
    client.log("   å¯åŠ å…¥ç¾¤ç»„: " + (bot.can_join_groups ? "æ˜¯" : "å¦"));
    client.log("   å¯é˜…è¯»ç¾¤ç»„æ¶ˆæ¯: " + (bot.can_read_all_group_messages ? "æ˜¯" : "å¦"));
    client.log("   æ”¯æŒå†…è”æŸ¥è¯¢: " + (bot.supports_inline_queries ? "æ˜¯" : "å¦"));
});
%}

### 8. è®¾ç½®Botæè¿°
POST https://api.telegram.org/bot{{telegramBotToken}}/setMyDescription
Content-Type: application/json

{
  "description": "Telegram Bot Demo - åŸºäºSpring Bootçš„ç¤ºä¾‹æœºå™¨äººé¡¹ç›®"
}

> {%
client.test("è®¾ç½®Botæè¿°æˆåŠŸ", function() {
    client.assert(response.status === 200, "çŠ¶æ€ç åº”ä¸º200");
    client.assert(response.body.ok === true, "è®¾ç½®åº”æˆåŠŸ");
    client.log("ğŸ“ Botæè¿°å·²æ›´æ–°");
});
%}

### 9. è·å–Botæè¿°
GET https://api.telegram.org/bot{{telegramBotToken}}/getMyDescription

### 10. è®¾ç½®Botç®€çŸ­æè¿°
POST https://api.telegram.org/bot{{telegramBotToken}}/setMyShortDescription
Content-Type: application/json

{
  "short_description": "Telegramæœºå™¨äººDemo"
}

### 11. è·å–Botç®€çŸ­æè¿°
GET https://api.telegram.org/bot{{telegramBotToken}}/getMyShortDescription

### ============ èœå•æŒ‰é’®ç®¡ç† ============

### 12. è®¾ç½®èœå•æŒ‰é’®
POST https://api.telegram.org/bot{{telegramBotToken}}/setChatMenuButton
Content-Type: application/json

{
  "menu_button": {
    "type": "commands"
  }
}

> {%
client.test("è®¾ç½®èœå•æŒ‰é’®æˆåŠŸ", function() {
    client.assert(response.status === 200, "çŠ¶æ€ç åº”ä¸º200");
    client.assert(response.body.ok === true, "è®¾ç½®åº”æˆåŠŸ");
    client.log("ğŸ“‹ èœå•æŒ‰é’®è®¾ç½®ä¸º: commands");
});
%}

### 13. è·å–èœå•æŒ‰é’®
GET https://api.telegram.org/bot{{telegramBotToken}}/getChatMenuButton

> {%
client.test("è·å–èœå•æŒ‰é’®æˆåŠŸ", function() {
    client.assert(response.status === 200, "çŠ¶æ€ç åº”ä¸º200");
    client.assert(response.body.ok === true, "è·å–åº”æˆåŠŸ");
    var button = response.body.result;
    client.log("ğŸ“‹ å½“å‰èœå•æŒ‰é’®ç±»å‹: " + button.type);
});
%}

### ============ æµ‹è¯•è¿æ¥æ€§ ============

### 14. æµ‹è¯•Botè¿æ¥
GET https://api.telegram.org/bot{{telegramBotToken}}/getUpdates

> {%
client.test("Botè¿æ¥æµ‹è¯•", function() {
    client.assert(response.status === 200, "çŠ¶æ€ç åº”ä¸º200");
    client.assert(response.body.ok === true, "è¿æ¥åº”æ­£å¸¸");

    if (response.body.result.length > 0) {
        client.log("ğŸ“¨ å¾…å¤„ç†æ¶ˆæ¯æ•°: " + response.body.result.length);
        response.body.result.forEach(function(update) {
            if (update.message) {
                client.log("   æ¶ˆæ¯: " + update.message.text + " (æ¥è‡ª: " + update.message.from.username + ")");
            }
        });
    } else {
        client.log("ğŸ“­ æš‚æ— å¾…å¤„ç†æ¶ˆæ¯");
    }
});
%}

### 15. å‘é€æµ‹è¯•æ¶ˆæ¯ (éœ€è¦å…ˆè·å–chat_id)
POST https://api.telegram.org/bot{{telegramBotToken}}/sendMessage
Content-Type: application/json

{
  "chat_id": "YOUR_CHAT_ID_HERE",
  "text": "ğŸ¤– Demo Botç®¡ç†APIæµ‹è¯•æ¶ˆæ¯\n\nBoté…ç½®å·²æ›´æ–°å®Œæˆï¼",
  "parse_mode": "HTML"
}

### ============ é”™è¯¯å¤„ç†æµ‹è¯• ============

### 16. æµ‹è¯•æ— æ•ˆtoken
GET https://api.telegram.org/botINVALID_TOKEN/getMe

> {%
client.test("æ— æ•ˆtokenæµ‹è¯•", function() {
    client.assert(response.status === 401, "åº”è¿”å›401æœªæˆæƒ");
    client.assert(response.body.error_code === 401, "é”™è¯¯ä»£ç åº”ä¸º401");
    client.log("âŒ æ— æ•ˆtokenæµ‹è¯•é€šè¿‡");
});
%}

### 17. æµ‹è¯•æ— æ•ˆwebhook URL
POST https://api.telegram.org/bot{{telegramBotToken}}/setWebhook
Content-Type: application/json

{
  "url": "http://invalid-url"
}

> {%
client.test("æ— æ•ˆwebhook URLæµ‹è¯•", function() {
    client.assert(response.status === 400, "åº”è¿”å›400é”™è¯¯è¯·æ±‚");
    client.log("âŒ æ— æ•ˆURLæµ‹è¯•é€šè¿‡");
});
%}

### ============ ä¸€é”®å®Œæ•´é…ç½® ============

### 18. å®Œæ•´é…ç½®Demo Bot
POST https://api.telegram.org/bot{{telegramBotToken}}/setMyCommands
Content-Type: application/json

{
  "commands": [
    {
      "command": "start",
      "description": "å¼€å§‹ä½¿ç”¨æœºå™¨äºº"
    },
    {
      "command": "help",
      "description": "æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯"
    },
    {
      "command": "balance",
      "description": "æŸ¥è¯¢ä½™é¢"
    }
  ]
}

> {%
client.test("å®Œæ•´èœå•é…ç½®", function() {
    client.assert(response.status === 200, "çŠ¶æ€ç åº”ä¸º200");
    client.log("âœ… Demo Botèœå•é…ç½®å®Œæˆ (start, help, balance)");
});
%}

### 19. è®¾ç½®å®Œæ•´Webhooké…ç½®
POST https://api.telegram.org/bot{{telegramBotToken}}/setWebhook
Content-Type: application/json

{
  "url": "{{webhookUrl}}",
  "secret_token": "{{secretToken}}",
  "max_connections": 40,
  "allowed_updates": ["message", "callback_query"],
  "drop_pending_updates": true
}

> {%
client.test("å®Œæ•´Webhooké…ç½®", function() {
    client.assert(response.status === 200, "çŠ¶æ€ç åº”ä¸º200");
    client.log("âœ… Demo Bot Webhooké…ç½®å®Œæˆ");
});
%}

### ============ æ¸…ç†æ“ä½œ ============

### 20. å®Œæ•´é‡ç½® - åˆ é™¤webhookå’Œèœå•
POST https://api.telegram.org/bot{{telegramBotToken}}/deleteWebhook
Content-Type: application/json

{
  "drop_pending_updates": true
}

###
POST https://api.telegram.org/bot{{telegramBotToken}}/deleteMyCommands
Content-Type: application/json

{}
